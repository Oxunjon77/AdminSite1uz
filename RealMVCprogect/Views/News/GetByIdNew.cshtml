@model EntityLayer.Concreat.News

@{
    ViewData["Title"] = "GetByIdNew";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<script src="https://cdn.jsdelivr.net/npm/interactjs@1.10.11/dist/interact.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<script src="~/js/updatenews.js"></script>
<link href="~/css/site.css" rel="stylesheet" />
<div class="card card-solid text-center">
    <div class="card-body pb-0">
        <button type="button" id="ButtonRu"
                class="btn btn-primary position-absolute"
                style="top:10px; right:10px; z-index:1000; border-radius:20px">
            <i class="fa fa-pen"></i>
            <span id="buttonText">Кейинги (русча версия)</span>
        </button>
        <div class="row d-flex align-items-stretch justify-content-center">
            <div class="col-12 col-sm-8 col-md-6 d-flex align-items-stretch">

                <div class="card bg-light w-100 shadow-sm">
                    <div class="card-header text-muted border-bottom-0">
                        <h4 id="pageUz" class="m-0">Саҳифани Таҳрирлаш</h4>
                    </div>

                    <form asp-action="UploadNews" asp-controller="News" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="newsId" value="@Model.Id" />

                        <div class="card-body pt-3 d-flex flex-column justify-content-center align-items-center position-relative" style="height: 250px; border: 3px dashed #ccc;">
                            <img id="image-preview-@Model.Id" src="@Model.photoNews" alt="Rasm" class="resizable img-uz" style="max-width: 100%; max-height: 150px;">
                            <img id="image-previewRu-@Model.Id" src="@Model.PhotoNewsRu" alt="RasmRu" class="resizable img-ru" style="max-width: 100%; max-height: 150px; display:none;">
                        </div>

                        <div class="card-footer">
                            <div class="form-group">
                                <label for="short-news">Қисқача янгилик</label>
                                <textarea id="short-news" name="title" class="form-control" rows="2">@Model.Title</textarea>
                            </div>
                            <div class="form-group" style="display:none">
                                <label for="short-newsRu">Краткие новости</label>
                                <textarea id="short-newsRu" name="titleRu" class="form-control" style="border-radius:15px" rows="2">@Model.TitleRu</textarea>
                            </div>

                            <div class="form-group mt-2" id="TextareaDetailed_newsUz">
                                <label>Тўлиқ янгилик</label>

                                <!-- Ko‘rinadigan div (readonly) -->
                                <div id="detailed-news-display"
                                     class="formatted-content border rounded p-2"
                                     onclick="openContentModal()"
                                     style="cursor: pointer; max-height: 200px; overflow-y: auto;">
                                    @Html.Raw(Model.Content)
                                </div>

                                <!-- Yuboriladigan yashirin input -->
                                <input type="hidden" id="detailed-news" name="content" value='@Html.Raw(Model.Content)' />
                            </div>

                            <div class="form-group mt-2" style="display:none" id="TextareaDetailed_news">
                                <label>Полные новости</label>

                                <!-- Ko‘rinadigan div (readonly) -->
                                <div id="detailed-news-displayRu"
                                     class="formatted-content border rounded p-2"
                                     onclick="openContentModalRu()"
                                     style="cursor: pointer; max-height: 200px; overflow-y: auto;">
                                    @Html.Raw(Model.ContentRu)
                                </div>

                                <!-- Yuboriladigan yashirin input -->
                                <input type="hidden" id="detailed-newsRu" name="contentRu" value='@Html.Raw(Model.ContentRu)' />
                            </div>


                            <!-- Modal oynasi -->
                            <div id="contentModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.4); z-index:1050; align-items:center; justify-content:center;">
                                <div class="modal-content p-3 bg-white rounded" style="width: 80%; max-width: 900px; max-height: 90vh; display: flex; flex-direction: column;">
                                    <h5>Тўлиқ янгиликни киритинг</h5>

                                    <!-- CKEditor joylashgan qism -->
                                    <div style="flex: 1 1 auto; max-height: 60vh; overflow-y: auto;">
                                        <textarea id="modal-content-text" class="form-control" style="width:100%; min-height:300px;"></textarea>
                                    </div>

                                    <!-- Tugmalar -->
                                    <div class="mt-3 d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary me-2" onclick="closeContentModal()">Bekor qilish</button>
                                        <button type="button" class="btn btn-primary" onclick="saveContent()">Saqlash</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Modal oynasi Ru-->
                            <div id="contentModalRu" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.4); z-index:1050; align-items:center; justify-content:center;">
                                <div class="modal-content p-3 bg-white rounded" style="width: 80%; max-width: 900px; max-height: 90vh; display: flex; flex-direction: column;">
                                    <h5>Введите полную новость</h5>

                                    <!-- CKEditor joylashgan qism -->
                                    <div style="flex: 1 1 auto; max-height: 60vh; overflow-y: auto;">
                                        <textarea id="modal-content-textRu" class="form-control" style="width:100%; min-height:300px;"></textarea>
                                    </div>

                                    <!-- Tugmalar -->
                                    <div class="mt-3 d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary me-2" onclick="closeContentModalRu()">Отменить</button>
                                        <button type="button" class="btn btn-primary" onclick="saveContentRu()">Сохранить</button>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="form-group">
                            <label id="StatusNews" for="statusInput">Янгилик ҳолати</label>
                            <input type="text" class="form-control" id="statusInput" name="statusText"
                                   value="@(Model.status == 1 ? "Асосий саҳифа" : "Черновик")" readonly />
                        </div>

                        <div class="form-group mt-2">
                            <label id="SelectStatus" for="statusSelect">Ҳолатни танланг</label>
                            <select id="statusSelect" class="form-control" onchange="updateStatus()">
                                <option value="1" selected="@(Model.status == 1 ? "selected" : null)">Асосий саҳифа</option>
                                <option value="0" selected="@(Model.status == 0 ? "selected" : null)">Черновик</option>
                            </select>
                        </div>

                        <div class="card-footer d-flex justify-content-center align-items-center">
                            <label id="uz" style="border-radius:15px;" class="btn btn-primary w-50 m-1" for="image-upload-@Model.Id">Расм Танлаш</label>
                            <label id="ru" style="border-radius:15px; display:none;" class="btn btn-primary w-50 m-1" for="image-uploadRu-@Model.Id">Выбрать изображение (Ru)</label>
                            <input type="file" id="image-upload-@Model.Id" name="files" accept="image/*" class="d-none" multiple onchange="previewImage(event,'image-preview-@Model.Id')">
                            <input type="file" id="image-uploadRu-@Model.Id" name="filesRu" accept="image/*" class="d-none" multiple onchange="previewImage(event, 'image-previewRu-@Model.Id')">
                        </div>

                        <input type="hidden" name="Status" id="Status" value="@Model.status" />
                        <button type="submit" class="btn btn-success w-50 m-1">Сақлаш</button>
                    </form>

                </div>

            </div>
        </div>
    </div>
</div>

<!-- CKEditor -->
<script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>

<script>
        let count = 0;
        let editorInstance;
        let editorInstanceRu;

     ClassicEditor
            .create(document.querySelector('#modal-content-text'), {
                ckfinder: {
                    uploadUrl: '/News/UploadImage'
                },
                toolbar: [
                    'heading', '|',
                    'bold', 'italic', 'underline', 'link', 'bulletedList', 'numberedList', '|',
                    'insertTable', 'blockQuote', 'imageUpload', 'mediaEmbed', '|',
                    'undo', 'redo',
                    '|',
                    'imageStyle:alignLeft', 'imageStyle:alignCenter', 'imageStyle:alignRight',
                    'imageResize', 'linkImage'
                ],
                image: {
                    toolbar: [
                        'imageStyle:alignLeft',
                        'imageStyle:alignCenter',
                        'imageStyle:alignRight',
                        '|',
                        'imageResize',
                        'imageTextAlternative',
                        'linkImage'
                    ],
                    styles: [
                        'alignLeft', 'alignCenter', 'alignRight'
                    ],
                    resizeOptions: [
                        {
                            name: 'resizeImage:original',
                            label: 'Original',
                            value: null
                        },
                        {
                            name: 'resizeImage:50',
                            label: '50%',
                            value: '50'
                        },
                        {
                            name: 'resizeImage:75',
                            label: '75%',
                            value: '75'
                        }
                    ],
                    resizeUnit: '%'
                },
                link: {
                    decorators: {
                        addTargetToExternalLinks: true,
                        defaultProtocol: 'https://'
                    }
                }
            })
            .then(editor => {
                editorInstance = editor;
            })
            .catch(error => {
                console.error(error);
            });

    function openContentModal() {
        const currentHtml = document.getElementById("detailed-news").value;
        editorInstance.setData(currentHtml);
        document.getElementById("contentModal").style.display = "flex";
    }


    function closeContentModal() {
        document.getElementById("contentModal").style.display = "none";
    }

    function saveContent() {
        const htmlValue = editorInstance.getData();
        document.getElementById("detailed-news").value = htmlValue;
        document.getElementById("detailed-news-display").innerHTML = htmlValue;
        closeContentModal();
    }

    function updateStatus() {
        const select = document.getElementById("statusSelect");
        const input = document.getElementById("statusInput");
        const hidden = document.getElementById("Status");

        if (select.value === "1") {
            input.value = "Асосий саҳифа";
            hidden.value = "1";
        } else {
            input.value = "Черновик";
            hidden.value = "0";
        }
    }


    ClassicEditor
            .create(document.querySelector('#modal-content-textRu'), {
                ckfinder: {
                    uploadUrl: '/News/UploadImage'
                },
                toolbar: [
                    'heading', '|',
                    'bold', 'italic', 'underline', 'link', 'bulletedList', 'numberedList', '|',
                    'insertTable', 'blockQuote', 'imageUpload', 'mediaEmbed', '|',
                    'undo', 'redo',
                    '|',
                    'imageStyle:alignLeft', 'imageStyle:alignCenter', 'imageStyle:alignRight',
                    'imageResize', 'linkImage'
                ],
                image: {
                    toolbar: [
                        'imageStyle:alignLeft',
                        'imageStyle:alignCenter',
                        'imageStyle:alignRight',
                        '|',
                        'imageResize',
                        'imageTextAlternative',
                        'linkImage'
                    ],
                    styles: [
                        'alignLeft', 'alignCenter', 'alignRight'
                    ],
                    resizeOptions: [
                        {
                            name: 'resizeImage:original',
                            label: 'Original',
                            value: null
                        },
                        {
                            name: 'resizeImage:50',
                            label: '50%',
                            value: '50'
                        },
                        {
                            name: 'resizeImage:75',
                            label: '75%',
                            value: '75'
                        }
                    ],
                    resizeUnit: '%'
                },
                link: {
                    decorators: {
                        addTargetToExternalLinks: true,
                        defaultProtocol: 'https://'
                    }
                }
            })
            .then(editor => {
                editorInstanceRu = editor;
            })
            .catch(error => {
                console.error(error);
            });


            function openContentModalRu() {
                const currentHtmlRu = document.getElementById("detailed-newsRu").value;
                editorInstanceRu.setData(currentHtmlRu);
                document.getElementById("contentModalRu").style.display = "flex";
            }

            function closeContentModalRu() {
                document.getElementById("contentModalRu").style.display = "none";
            }

            function saveContentRu() {
                const htmlValue = editorInstanceRu.getData();
                document.getElementById("detailed-newsRu").value = htmlValue;
                document.getElementById("detailed-news-displayRu").innerHTML = htmlValue;
                closeContentModalRu();
            }

            function updateStatus() {
                const select = document.getElementById("statusSelect");
                const input = document.getElementById("statusInput");
                const hidden = document.getElementById("Status");

                if (select.value === "1") {
                    input.value = "Асосий саҳифа";
                    hidden.value = "1";
                } else {
                    input.value = "Черновик";
                    hidden.value = "0";
                }
            }

            document.getElementById('ButtonRu').addEventListener('click',function(){
                count++;

                const imgUz = document.querySelector('.img-uz');
                const imgRu = document.querySelector('.img-ru');

                if (count % 2 === 0) {
                    // Uzbekcha polyalarni ko‘rsatamiz
                    document.getElementById('short-news').parentElement.style.display = "block";
                    document.getElementById('TextareaDetailed_newsUz').style.display = "block";
                    document.getElementById('uz').style.display = "block";
                    document.getElementById('pageUz').textContent = 'Саҳифани Таҳрирлаш';
                    document.getElementById('StatusNews').textContent = 'Янгилик ҳолати';
                    document.getElementById('SelectStatus').textContent = 'Ҳолатни танланг';

                    // Ruscha polyalarni yashiramiz
                    document.getElementById('short-newsRu').parentElement.style.display = "none";
                    document.getElementById('TextareaDetailed_news').style.display = "none";
                    document.getElementById('ru').style.display = "none";
                    document.getElementById('buttonText').textContent = 'Кейинги (русча версия)';

                    imgUz.style.display = "block";
                    imgRu.style.display = "none";
                } 
                else if(count % 2 != 0){
                    // Uzbekcha polyalarni yashirish
                    document.getElementById('short-news').parentElement.style.display = "none";
                    document.getElementById('detailed-news').parentElement.style.display = "none";
                    document.getElementById('uz').style.display = "none";

                    // Ruscha polyalarni ko'rsatish
                    document.getElementById('short-newsRu').parentElement.style.display = "block";
                    document.getElementById('TextareaDetailed_news').style.display = "block";
                    document.getElementById('ru').style.display = "block";
                    document.getElementById('buttonText').textContent = 'Следующая (узбекская версия)';
                    document.getElementById('pageUz').textContent = 'Редактировать страницу';
                    document.getElementById('StatusNews').textContent = 'Статус новостей';
                    document.getElementById('SelectStatus').textContent = 'Выберите статус';

                    imgUz.style.display = "none";
                    imgRu.style.display = "block";
                }
            });

</script>